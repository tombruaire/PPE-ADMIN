<!DOCTYPE html>
<html>
<head>
    <title>mairievilliers - Configurations</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/fonts.googleapis.css">
    <link rel="stylesheet" type="text/css" href="css/mariev-userstyle.css">
</head>
<body>

<div class="wrapper">
    <div class="main">
        <main class="content">
            <div class="container-fluid p-0">
                <h1 class="h1 mb-3 text-center">mairievilliers - Configurations</h1>
                <div class="row d-flex justify-content-center">
                    <div class="col-md-auto">
                        <div class="card">
                            <div class="card-body">
                                <p class="fs-4 text-center text-dark">
                                    Certaines pages du site ont besoins de configurations pour fonctionner
                                </p>
                                <hr>
                            </div>
                            <div class="mb-3">
                                <div class="mb-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h3 class="text-center mb-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-hdd me-1" viewBox="0 0 16 16">
                                                    <path d="M4.5 11a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1zM3 10.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                                                    <path d="M16 11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V9.51c0-.418.105-.83.305-1.197l2.472-4.531A1.5 1.5 0 0 1 4.094 3h7.812a1.5 1.5 0 0 1 1.317.782l2.472 4.53c.2.368.305.78.305 1.198V11zM3.655 4.26L1.592 8.043C1.724 8.014 1.86 8 2 8h12c.14 0 .276.014.408.042L12.345 4.26a.5.5 0 0 0-.439-.26H4.094a.5.5 0 0 0-.44.26zM1 10v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1z"/>
                                                </svg>
                                                Base de donn√©es - Partie 2
                                            </h3>
                                            <p class="text-center text-warning fw-bold">√Ä rajouter dans la base de donn√©es &quot;villiers.sql&quot; sur le terminal ou phpMyAdmin</p>
                                            <div class="mb-3">
                                                <i class="align-middle ms-2" data-feather="hard-drive"></i> C :
                                                <i class="align-middle" data-feather="chevron-right"></i>
                                                <strong>üìÅ wamp | xampp</strong>
                                                <i class="align-middle" data-feather="chevron-right"></i>
                                                <strong>üìÅ www | htdocs</strong>
                                                <i class="align-middle" data-feather="chevron-right"></i>
                                                <strong>üìÅ PPE-ADMIN</strong>
                                                <i class="align-middle" data-feather="chevron-right"></i>
                                                <strong>üìÑ admin.sql</strong>
                                            </div>
                                            <i class="align-middle ms-2" data-feather="hard-drive"></i> C :
                                            <i class="align-middle" data-feather="chevron-right"></i>
                                            <strong>üìÅ wamp | xampp</strong>
                                            <i class="align-middle" data-feather="chevron-right"></i>
                                            <strong>üìÅ www | htdocs</strong>
                                            <i class="align-middle" data-feather="chevron-right"></i>
                                            <strong>üìÅ PPE-ADMIN</strong>
                                            <i class="align-middle" data-feather="chevron-right"></i>
                                            <strong>üìÑ trigger.sql</strong>
                                            <p class="text-lg mb-1">
                                                <br><br><font class="ms-1 text-success">
                                                    Code v√©rifi√© sur serveur MySQL
                                                </font>
                                                <i class="align-middle text-success" data-feather="check"></i>
                                                <button type="button" id="button" class="btn btn-primary float-end align-top">
                                                    Copier le code
                                                    <i class="align-middle ms-1 fas fa-fw fa-copy"></i>
                                                </button>
                                            </p>
<pre id="database" class="snippet fs-lg mt-3"><code id="code" class="sql">Create table admin (
    idadmin int(11) not null auto_increment,
    mail varchar(255),
    mdp varchar(255),
    droit int not null default 0,
    primary key (idadmin)
) ENGINE=InnoDB;

Insert into admin values
(1, "test@gmail.com", "107d348bff437c999a9ff192adcb78cb03b8ddc6", 0),
(2, "admin@gmail.com", "107d348bff437c999a9ff192adcb78cb03b8ddc6", 1);

Create table online (
    id int(11) not null auto_increment,
    time int,
    user_ip varchar(255),
    primary key (id)
) ENGINE=InnoDB;

Create table compteur (
    idcompteur int(11) not null auto_increment,
    libelle varchar(255),
    nombre int,
    primary key (idcompteur)
) ENGINE=InnoDB;

Insert into compteur values
(1, "Nombre d'utilisateurs", 3),
(2, "Nombre d'√©v√®nements", 4),
(3, "Nombre d'habitants", 4),
(4, "Nombre d'associations", 2),
(5, "Nombre d'√©coles", 2),
(6, "Nombre d'enfants", 2),
(7, "Nombre de d√©c√®s", 2),
(8, "Nombre de participations", 2),
(9, "Nombre de membres d'une association", 2),
(10, "Nombre d'inscription √† une √©cole", 4),
(11, "Nombre de mariages", 2),
(12, "Nombre de conservatoire", 22);

Create table old_events (
    idold int(11) not null auto_increment,
    idevent int(11) not null,
    nomevent varchar(50),
    dateevent date,
    lieuevent varchar(50),
    nbievent int(25),
    prixplaceevent float(25),
    placestotal int(25),
    date_histo datetime,
    event_histo varchar(10),
    primary key (idold, idevent)
) ENGINE=InnoDB;

DROP TRIGGER IF EXISTS compteur_insert_utilisateur;
DELIMITER //
CREATE TRIGGER compteur_insert_utilisateur
AFTER INSERT ON utilisateurs
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'utilisateurs";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_utilisateur;
DELIMITER //
CREATE TRIGGER compteur_delete_utilisateur
AFTER DELETE ON utilisateurs
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'utilisateurs";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_evenements;
DELIMITER //
CREATE TRIGGER compteur_insert_evenements
AFTER INSERT ON evenements
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'√©v√®nements";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_evenements;
DELIMITER //
CREATE TRIGGER compteur_delete_evenements
AFTER DELETE ON evenements
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'√©v√®nements";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_habitants;
DELIMITER //
CREATE TRIGGER compteur_insert_habitants
AFTER INSERT ON habitants
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'habitants";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_habitants;
DELIMITER //
CREATE TRIGGER compteur_delete_habitants
AFTER DELETE ON habitants
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'habitants";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_associations;
DELIMITER //
CREATE TRIGGER compteur_insert_associations
AFTER INSERT ON associations
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'associations";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_associations;
DELIMITER //
CREATE TRIGGER compteur_delete_associations
AFTER DELETE ON associations
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'associations";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_ecoles;
DELIMITER //
CREATE TRIGGER compteur_insert_ecoles
AFTER INSERT ON ecoles
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'√©coles";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_ecoles;
DELIMITER //
CREATE TRIGGER compteur_delete_ecoles
AFTER DELETE ON ecoles
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'√©coles";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_enfants;
DELIMITER //
CREATE TRIGGER compteur_insert_enfants
AFTER INSERT ON enfants
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre d'enfants";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_enfants;
DELIMITER //
CREATE TRIGGER compteur_delete_enfants
AFTER DELETE ON enfants
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre d'enfants";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_deces;
DELIMITER //
CREATE TRIGGER compteur_insert_deces
AFTER INSERT ON deces
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre de d√©c√®s";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_deces;
DELIMITER //
CREATE TRIGGER compteur_delete_deces
AFTER DELETE ON deces
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre de deces";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_mariages;
DELIMITER //
CREATE TRIGGER compteur_insert_mariages
AFTER INSERT ON marier
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre de mariages";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_mariages;
DELIMITER //
CREATE TRIGGER compteur_delete_mariages
AFTER DELETE ON marier
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre de mariages";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_insert_conservatoire;
DELIMITER //
CREATE TRIGGER compteur_insert_conservatoire
AFTER INSERT ON conservatoires
FOR EACH ROW UPDATE compteur SET nombre = nombre + 1
WHERE libelle = "Nombre de conservatoire";//
DELIMITER ;

DROP TRIGGER IF EXISTS compteur_delete_conservatoires;
DELIMITER //
CREATE TRIGGER compteur_delete_conservatoires
AFTER DELETE ON conservatoires
FOR EACH ROW UPDATE compteur SET nombre = nombre - 1
WHERE libelle = "Nombre de conservatoire";//
DELIMITER ;

DROP TRIGGER IF EXISTS insert_inscrit_evenements;
DELIMITER //
CREATE TRIGGER insert_inscrit_evenements
AFTER DELETE ON participations
FOR EACH ROW 
BEGIN
UPDATE evenements SET nbievent = nbievent + 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS delete_inscrit_evenements;
DELIMITER //
CREATE TRIGGER delete_inscrit_evenements
AFTER DELETE ON participations
FOR EACH ROW 
BEGIN
UPDATE evenements SET nbievent = nbievent - 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS insert_eleve_conservatoires;
DELIMITER //
CREATE TRIGGER insert_eleve_conservatoires
AFTER DELETE ON inscrits_conservatoires
FOR EACH ROW 
BEGIN
UPDATE conservatoires SET effectifs = effectifs + 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS delete_eleve_conservatoires;
DELIMITER //
CREATE TRIGGER delete_eleve_conservatoires
AFTER DELETE ON inscrits_conservatoires
FOR EACH ROW 
BEGIN
UPDATE conservatoires SET effectifs = effectifs - 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS insert_inscrits_associations;
DELIMITER //
CREATE TRIGGER insert_inscrits_associations
AFTER INSERT ON inscrits_associations
FOR EACH ROW
BEGIN
UPDATE associations SET inscrits = inscrits + 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS delete_inscrits_associations;
DELIMITER //
CREATE TRIGGER delete_inscrits_associations
AFTER DELETE ON inscrits_associations
FOR EACH ROW 
BEGIN
UPDATE associations SET inscrits = inscrits - 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS insert_eleve_ecole;
DELIMITER //
CREATE TRIGGER insert_eleve_ecole
AFTER INSERT ON inscrits_ecoles
FOR EACH ROW
BEGIN
UPDATE ecoles SET eleves = eleves + 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS delete_eleve_ecole;
DELIMITER //
CREATE TRIGGER delete_eleve_ecole
AFTER DELETE ON inscrits_ecoles
FOR EACH ROW 
BEGIN
UPDATE ecoles SET eleves = eleves - 1;
End //
DELIMITER ;

DROP TRIGGER IF EXISTS after_update_event;
DELIMITER //
CREATE TRIGGER after_update_event
AFTER UPDATE ON evenements
FOR EACH ROW 
BEGIN
    INSERT INTO old_events (
        idevent,
        nomevent,
        dateevent,
        lieuevent,
        nbievent,
        prixplaceevent,
        placestotal,
        date_histo,
        event_histo
    ) VALUES (
        OLD.idevent,
        OLD.nomevent,
        OLD.dateevent,
        OLD.lieuevent,
        OLD.nbievent,
        OLD.prixplaceevent,
        OLD.placestotal,
        NOW(),
        'UPDATE'
    );
End //
DELIMITER ;

DROP TRIGGER IF EXISTS after_delete_event;
DELIMITER //
CREATE TRIGGER after_delete_event
AFTER DELETE ON evenements
FOR EACH ROW 
BEGIN
    INSERT INTO old_events (
        idold,
        idevent,
        nomevent,
        dateevent,
        lieuevent,
        nbievent,
        prixplaceevent,
        placestotal,
        date_histo,
        event_histo
    ) VALUES (
        idold,
        OLD.idevent,
        OLD.nomevent,
        OLD.dateevent,
        OLD.lieuevent,
        OLD.nbievent,
        OLD.prixplaceevent,
        OLD.placestotal,
        NOW(),
        'DELETE'
    );
End //
DELIMITER ;

</code></pre>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="js/app.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    $("pre code").each(function(i, block) {
        hljs.highlightBlock(block);
    });
});
</script>

<script type="text/javascript">
function copyFunction() {
    const copyText = document.getElementById("database").textContent;
    const textArea = document.createElement('textarea');
    textArea.textContent = copyText;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand("copy");
    document.body.removeChild(textArea);
    alert("Code copi√© dans le press-papier ‚úî");
}
document.getElementById('button').addEventListener('click', copyFunction);
</script>

</body>
</html>